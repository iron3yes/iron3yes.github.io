<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Day 1 â€” Christmas Puzzle</title>
<style>
body{margin:0;background:linear-gradient(#071a2e,#07385a);font-family:Arial,sans-serif;color:#fff}
.wrap{max-width:900px;margin:20px auto;padding:18px;background:rgba(255,255,255,0.05);border-radius:12px}
h1{margin-top:0}
.note-badge{display:inline-block;padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.08);margin-top:8px}
.controls{margin-top:10px}
button.control{padding:8px 12px;margin-right:8px;border-radius:6px;border:none;background:#ffeb3b;color:#000;font-weight:bold;cursor:pointer}
#snow-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:9999}
@media(max-width:600px){ .wrap{margin:8px;padding:12px} }
</style>
</head>
<body>
<canvas id="snow-canvas"></canvas>
<div class="wrap">

<script>
(function() {
  const now = new Date();
  const avail = new Date("2025-12-25T00:00:00");
  if (now < avail) {
    document.write("<h1>This puzzle unlocks on " + avail.toDateString() + "</h1>");
    document.write("<p>Come back on that day to begin!</p>");
    throw new Error("Locked");
  }
})();
</script>

<div style="display:flex;justify-content:space-between;align-items:center">
  <h1>Day 1</h1>
  <div class="controls">
    <button class="control" id="soundToggle">Enable Sound</button>
    <button class="control" id="musicToggle">Toggle Music</button>
  </div>
</div>
<h2>Reassemble the Christmas Picture</h2>
<p>Click two pieces to swap them until the image is correct.</p>
<div id="board" style="width:330px;height:330px;display:flex;flex-wrap:wrap;border:4px solid #3a6;margin-bottom:12px"></div>
<div id="solved" style="display:none;margin-top:8px;padding:8px;background:rgba(255,255,255,0.06)"><strong>Password:</strong> MISTLETOE<br>Next: /day2</div>
<script>
// simple 3x3 swap jigsaw (replace image URL if desired)
const board = document.getElementById('board');
let first=null;
const imgURL='https://images.unsplash.com/photo-1549880338-65ddcdfd017b?auto=format&fit=crop&w=660&q=80';
const size=110;
const positions=[];
for(let i=0;i<9;i++) positions.push(i);
for(let i=positions.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [positions[i],positions[j]]=[positions[j],positions[i]]; }
for(let i=0;i<9;i++){
  const d=document.createElement('div'); d.style.width=size+'px'; d.style.height=size+'px'; d.style.boxSizing='border-box';
  d.style.backgroundImage='url('+imgURL+')'; d.style.backgroundSize='330px 330px';
  d.style.backgroundPosition = '-' + ((positions[i]%3)*size) + 'px -' + (Math.floor(positions[i]/3)*size) + 'px';
  d.style.border='1px solid rgba(255,255,255,0.08)'; d.style.cursor='pointer';
  d.addEventListener('click',()=>{
    if(!first){ first=d; d.style.outline='3px solid #ffcc00'; return; }
    const tmp = first.style.backgroundPosition;
    first.style.backgroundPosition = d.style.backgroundPosition;
    d.style.backgroundPosition = tmp;
    first.style.outline='';
    first=null;
    checkSolved();
  });
  board.appendChild(d);
}
function checkSolved(){
  const pieces = board.children;
  let ok=true;
  for(let i=0;i<pieces.length;i++){
    const expected = '-' + ((i%3)*size) + 'px -' + (Math.floor(i/3)*size) + 'px';
    if(pieces[i].style.backgroundPosition !== expected) ok=false;
  }
  if(ok){
    document.getElementById('solved').style.display='block';
  }
}
</script>
<hr style="border-color:rgba(255,255,255,0.08)">
<div style="text-align:left">
<p>Melody piece for Day 1: <span class="note-badge">G4</span></p>
<p>Collect all 12 pieces and reproduce the melody on Day 12 to open the final vault.</p>
</div>
</div>

<script>
// Snow
(function() {
  const canvas=document.getElementById('snow-canvas');
  const ctx=canvas.getContext('2d');
  let W,H,flakes=[];
  function setup() {
    W=canvas.width=window.innerWidth;
    H=canvas.height=window.innerHeight;
    flakes=[];
    for(let i=0;i<50;i++) flakes.push({x:Math.random()*W,y:Math.random()*H,r:1+Math.random()*3,d:Math.random()});
  }
  function draw() {
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='rgba(255,255,255,0.85)';
    for(const f of flakes) {
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
      f.y+=0.6+f.r*0.06;
      f.x+=Math.sin(f.d+=0.01)*0.5;
      if(f.y>H) f.y=-5;
    }
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize', setup);
  setup(); draw();
})();

// Audio helpers
let audioCtx=null;
const freqs = {"C4": 261.63, "D4": 293.66, "E4": 329.63, "F4": 349.23, "G4": 392.0, "A4": 440.0, "B4": 493.88, "C5": 523.25};

function ensureAudio() {
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function playNote(name,dur=0.45,vol=0.7) {
  try {
    ensureAudio();
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    o.frequency.value = freqs[name] || 440;
    g.gain.value = vol;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    o.stop(audioCtx.currentTime + dur + 0.02);
  } catch(e){}
}

document.addEventListener('click', function initOnce() {
  ensureAudio();
  document.getElementById('soundToggle')?.addEventListener('click', ()=>playNote('C4',0.3,0.7));
  document.getElementById('musicToggle')?.addEventListener('click', ()=>playNote('G4',0.4,0.4));
  document.removeEventListener('click', initOnce);
});
</script>

</body></html>

